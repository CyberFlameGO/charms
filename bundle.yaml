---
applications:
  worker:
    charm: "./worker.charm"
    scale: 1
  mlflow:
    charm: "./mlflow.charm"
    scale: 1
  mysql:
    charm: "cs:~charmed-osm/mariadb-k8s-34"
    scale: 1

  minio:
    # From https://github.com/canonical/bundle-kubeflow/blob/master/bundle.yaml
    charm: "cs:minio-55"

  # avoid colliding with name of minio for kubeflow, which uses a newer charm
  # which exposes an 'object-storage' interface rather than a 'minio'
  # interface, which the mlflow charm can't speak yet.
  minio-old:

    charm: "cs:~kubeflow-charmers/minio-146"
    # Located charm "minio" in charm-store, revision 146
    # Located charm "mariadb-k8s" in charm-store, revision 34
    # Located charm "prometheus-k8s" in charm-store, revision 32
    # Executing changes:
    # - upload charm minio from charm-store for series kubernetes
    # - upgrade minio from charm-store using charm minio for series kubernetes
    # ERROR cannot deploy bundle: cannot upgrade application "minio" to charm "cs:~kubeflow-charmers/minio-146": would break relation "argo-controller:object-storage minio:object-storage"

    #charm: "cs:~kubeflow-charmers/minio-8"
    #
    # Located charm "minio" in charm-store, revision 8
    # Located charm "mariadb-k8s" in charm-store, revision 34
    # Located charm "prometheus-k8s" in charm-store, revision 32
    # Executing changes:
    # - upload charm minio from charm-store for series kubernetes
    # - upgrade minio from charm-store using charm minio for series kubernetes
    # ERROR cannot deploy bundle: Juju on containers does not support updating storage on a statefulset.
    # The new charm's metadata contains updated storage declarations.
    # You'll need to deploy a new charm rather than upgrading if you need this change.
    #  not supported (not supported)

    scale: 1

  prometheus:
    charm: "cs:~charmed-osm/prometheus-k8s-32"
    options:
      default-target: 'mlflow:5000'
    scale: 1
bundle: kubernetes
description: "MLflow"
relations:
  - - mlflow:db
    - mysql
  - - mlflow:minio
    - minio-old
    #- minio:object-storage
  - - mlflow:prometheus
    - prometheus
  - - worker:pod-defaults
    - mlflow:pod-defaults
